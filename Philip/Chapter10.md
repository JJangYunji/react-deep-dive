# 10장 리액트 17과 18의 변경사항 살펴보기
React 15(2017)

React 16(2017)
- Fiber 도입

React 16.3(2018) 
- Context API

React 16.8(2019)
- Hooks 도입

React 17(2020)
- 내부 아키텍쳐 변환, JSX변환

React 18(2022)
- Concurrent Mode


## 10.1 리액트 17
16 -> 17의 업그레이드는 문제가 발생할 소지가 적다.

### 10.1.1 리액트의 점진적인 업그레이드
레거시 API를 남겨두기 위해 리액트 버전 17을 사용함

리액트 17은 리액트 16울 게으르게(lazy)불러온다.

## 10.1.2 이벤트 위임 방식의 변경
```javascript
useEffect(() => {
    buttonRef.current.onclick = function click() { alert("HI") }
})
```
- 리액트 애플리케이션에서 DOM에 이벤트를 추가하는 방식

-> DOM의 이벤트 핸들러를 보면 noop이라는 핸들러가 부착되어 있으며, 아무것도 하지 않는다.

-> 리액트는 이벤트 타입마다 하나의 핸들러를 루트에 부착한다.

```typescript
<button onClick={() => { alert("HI")}} />
```
- DOM의 onclick에 직접 함수를 추가하는 방식


**이벤트 단계의 구성**
- 캡쳐 : 이벤트 핸들러가 트리 최상단 요소로부터 타깃 요소까지 도달
- 타깃 : 이벤트 핸들러가 타깃 노드에 도달, 이벤트가 호출된다.
- 버블링 : 이벤트가 발생한 요소에서부터 시작해 최상위 요소까지 올라감, 동작 수행

이 때, 단 한번 이벤트를 동작시켜야한다면 상위 요소에 모든 이벤트를 위임할 수도 있다.

리액트16 : document(DOM 루트, 서로 다른 버전간에 공유됨)
리액트17 : root(리액트 루트, 서로 다른 버전간에 분리 가능)

## 10.1.3 import React from 'react'가 더 이상 필요 없다.
JSX는 트랜스파일링이 필요하였는데, 이에 따라 16버전까지는 쓰지 않더라도 import React from 'react'구문을 최상단에 삽입하곤 했다.

```javascript
// React 16
const Component = (
    <div>
        <span>hi</span>
    </div>
)

var Component = React.createElement('div',null,React.createElement(...))

// React 17

var _jsxRuntime = require('react/jsx-runtime')

var Component = (0, _jsxRuntime.jsx)('div', {...})
```

### 10.1.4 그 밖의 변경사항
**이벤트 풀링 제거**
브라우저의 기본 이벤트를 처리하기 위한 Synthetic 이벤트를 사용하기 위해 메모리를 매번 관리해야 했는데, 이를 위한 이벤트 풀링이 있었다.
1. 이벤트 핸들러가 이벤트를 발생시킨다.
2. Synthetic 이벤트 풀에서 참조를 가져온다
3. 이벤트 정보를 합성 이벤트 객체에 넣는다.
4. 유저가 지정한 이벤트 리스너가 실행된다.
5. 이벤트 객체가 초기화된다.

-> 별로 성능향상에 도움되지 않아 삭제됨

**useEffect 클린업 함수 비동기 실행**
return문으로 실행되는 클린업 함수가 비동기로 실행되게 되었다.

**undefined에 대한 에러 처리 일관화**

# 10.2 리액트 18 버전 살펴보기
## 10.2.1 새로 추가된 훅 살펴보기
**useId**
컴포넌트별로 대해 유니크한 값을 생성하는 훅

->컴포넌트 내에 고유한 값을 생성할 때 사용

**useTransition**
UI 변경을 가로막지 않고 상태를 업데이트 할 수 있는 훅
: 상태 업데이트가 시작되면 멈출 수 없어 지연되는 현상이 있었는데, 비동기적으로 작동해서 업데이트를 멈추고 즉시 업데이트할 수 있다.

-상태 업데이틑 함수와 관련된 작업만 넘길 수 있다.
-동기 함수를 넘겨주어야 한다.

... 다양한 훅들이 있다 :)

아무튼 동시성을 많이 확보했다~

### 10.2.2 react-dom/client
리액트 트리를 만들 때 사용되는 API가 변경되었다.

**createRoot**

render => createRoot & render

**hydrateRoot**
하이드레이션(예전에 살펴봤음)을 하기 위한 메서드

### 10.2.3 react/dom/server
서버에서 컴포넌트 생성하는 API에도 변경이 있었다.

### 10.2.4 Automatic Batching
여러 상태 업데이트를 하나의 리렌더링으로 묶어서 성능을 향상시키게 되었다.

### 10.2.5 더더욱 엄격해진 엄격모드
다음과 같은것들을 더 걸러주도록 되었다.
- 더 이상 안전하지 않은 특정 생명주기를 사용하는 컴포넌트에 대한 경고
- 문자열 ref 사용금지
- findDOMNode에 대한 경고 출력
- 레거시 Context API 사용시 경고
- 예상치 못한 부작용 검사

엄격모드에서 두번실행되는 이유 -> 모든 컴포넌트가 순수하다고 가정하기 때문에 두번 실행해서 결과물을 보여주는 것.

### 10.2.6 Suspense 기능 강화
컴포넌트를 동적으로 가져오는 것.

전반적으로 비동기와 동시성부분에서 계속해서 개선되고 있는 것 같다.



