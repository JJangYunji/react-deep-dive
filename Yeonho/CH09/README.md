# 모던 리액트 개발 도구로 개발 및 배포 환경 구축하기

### Next.js로 리액트 개발 환경 구축

CNA(create-next-app) 없이 하나씩 구축하기 (Next.js는 Framework 이기 때문에 CNA를 따라가는 것이 오히려 좋을 수 있음)

1. package.json 생성
   npm init을 통해 package.json을 정의할 수 있음

2. 이후 Next.js의 핵심 라이브러리를 설치
   `React, react-dom next`

3. 개발시 용이한 패키지 설치
   `@types/react, @types/react-dom, @types/node, eslint, eslint-config-next` 등

4. tsconfig.json 작성

5. next.config.js 작성
   `reactStrictMode` - react의 엄격 모드를 활성화
   `poweredByHeader` - 일반적으로 보안 취약점으로 취급되는 X-Powered-By 헤더를 제거
   `eslint.ignoreDuringBuilds` : 빌드 시 ESLint 무시

6. ESLint와 Prettier 설정

7. 스타일 설정
   여러가지 스타일 적용 법이 있지만,
   `styleX`라는 것이 눈에 띈다.
   `emotion`이나 `StyledComponent` 처럼 컴포넌트 형태로 작성하지만, 빌드 시에는 컴파일러를 통해 `css`로 변환이 가능함
   Next.js와 잘 어울릴 것으로 보임

8. App 코드 작성

### Github 활용하기

- **CI 환경 구축하기**
  CI(Continuous Integration)란 지속적 통합이라는 의미로, 여러 개발자가 기여한 코드들을 지속적으로 빌드하고 테스트 하여 코드의 정합성을 확인하는 과정을 의미한다.
  CI의 핵심은 저장소에서 코드의 변화가 있을 때 마다 전체 소프트웨어의 정합성을 확인하기 위한 작업을 자동으로 실행해야한다.

여기서 자동으로 실행해야 하는 작업이란 테스트, 빌드, 정적 분석, 보얀 취약점 분석 등이 있다.

Github Action은 Github를 기반으로 발생하는 다양한 이벤트를 트리거 삼아서 작업을 할 수 있게 도와주는 것이다.

1. Github의 어떤 브랜치에 푸쉬가 발생하면 빌드를 수행한다.
2. Github의 특정 브랜치가 메인 브랜치를 대상으로 풀 리퀘스트가 열리면 빌드, 테스트, 정적 분석등을 수행한다.

#### Github Action의 기본 개념

- 러너 (runner) : 러너란 파일로 작성된 깃허브 액션이 실행되는 서버를 의미한다. 특별히 지정하지 않으면 공용 깃헙 액션 서버를 이용하며, 별도의 러너를 구축해 자체적으로 운영할 수도 있다.

- 액션 (action) : 러너에서 실행되는 하나의 작업 단위를 의미한다. yaml 파일로 작성된 내용을 하나의 액션으로 볼 수 있다.

- 이벤트 (event) : 깃헙 액션의 실행을 일으키는 이벤트를 의미한다. 개발자의 필요에 따라 한 개 이상의 이벤트를 지정할 수 있다. 또한 특정 브랜치를 지정하는 이벤트도 가능하다.

  - pull_request : PR과 관련된 이벤트

  - issues : 이슈와 관련된 이벤트

  - push : 커밋이나 태그가 푸쉬될 때 발생하는 이벤트

  - schedule : 저장소에서 발생하는 이벤트와 별개로 특정 시간에 실행되는 이벤트를 의미, 여기서 시간은 cron에서 사용되는 시간이며 cron은 유닉스 계열 운영체제에서 실행되는 시간 기반 잡 스케줄러이다. 특정 시간을 표현할 때 다음과 같은 형식을 취한다.
    `5 4 * * * - 매일 4시 5분에 실행` : 분, 시간, 일, 월, 요일 순으로 표현하며, \*는 모든 값을 의미한다.

- 잡 (Jobs) : 잡이란 하나의 러너에서 실행되는 여러 스텝의 모음을 의미한다. 하나의 액션에서 여러 잡을 생성할 수 있으며, 특별히 선언한 게 없다면 내부 가상머신에서 각 잡은 병렬로 실행된다.

- 스텝 (steps) : 잡 내부에서 일어나는 하나하나의 작업을 의미한다. 셀 명령어나 다른 액션을 실행할 수도 있다. 이 작업은 병렬로 일어나지 않는다.

위와 같은 CI 환경은 Github 뿐만 아니라, 다른 Git 저장소 서비스에서도 제공 하는 경우가 많으므로, 환경에 맞게 살펴보는 것이 좋을 것으로 보인다.

### React App 배포하기

이 부분은 우선 개요만,, 내가 본 서비스는 실제로 PR이 올라갔을 때 Netlify를 통해 배포되어 테스트를 진행할 수 있었다.
즉, 어떠한 변경점이 있을 때 실제로 앱을 빌드하고 배포하여 테스트를 진행해볼 수 있다는 점이 강점이다.

https://github.com/Kitware/VolView/pull/581

### React App Dockerize 하기

Docker란 ?
도커 홈페이지의 <meta> 태그 중 <description>을 살펴보면 도커가 어떤 서비스라고 정의되어있는 지 알 수 있다.

"도커는 개발자가 모던 애플리케이션을 구축, 공유, 실행하는 것을 도와줄 수 있도록 설계된 플랫폼이다. 도커는 지루헌 설정 과정을 대신해 주므로 코드 작성하는 일에만 집중할 수 있다."

#### Docker 용어

컨테이너 : 도커의 이미지를 실행한 상태를 컨테이너라 한다. 컨테이너는 독립된 공간이며, 이미지가 목표하는 운영체제, 파일 시스템, 각종 자원 및 네트워크 등이 할당되어 실행될 수 있는 독립된 공간이 생성된다.

Dockerfile : 어떤 이미지 파일을 만들 지 정의하는 파일이다. 이 파일을 빌드하면 이미지를 만들 수 있다.

태그 : 이미지를 식별할 수 있는 레이블 값을 의미한다. 일반적으로 **이름 : 태그명** 의 형태로 구성되어 있다. 대표적인 이미지 ubuntu:latest 이며, ubuntu는 이미지 이름이고 latest는 태그명이다.

리포지터리 : 이미지를 모아두는 저장소

레지스트리 : 리포지터리에 접근할 수 있게 해주는 서비스를 의미한다. 대표적인 레지스트리로는 도커 허브가 있다.
Azure는 Azure Container Registry가 있다.

#### 자주 쓰는 Docker CLI 명령어

docker build : Dockerfile을 기준으로 이미지를 빌드하는 작업을 의미한다. 일반적으로 태그를 부여하는 옵션인 -t와 함께 많이 사용된다.

docker push : 이미지나 리포지터리를 도커 레지스트리에 업로드 하는 과정을 의미한다.

docker tag : 이미지에 태그를 생성하는 명령어이다. 이름을 수정하는 것이 아닌 기존 이미지에 새로운 태그를 붙인다는 것이다.

docker inspect : 이미지나 컨테이너의 세부 정보를 출력하는 명령어이다.

docker run : 이미지를 기반으로 새로운 컨테이너를 생성하는 명령어 이다.

docker ps : 현재 가동 중인 컨테이너 목록을 확인할 수 있는 명령어이며, -all 과 함께 실행한다면 현재 가동중이지 않은 멈춘 컨테이너도 확인할 수 있다.

docker rm : 컨테이너를 삭제할 수 있는 명령어, 실행 중인 컨테이너는 docker stop을 통해 중지하고 삭제해야한다.
