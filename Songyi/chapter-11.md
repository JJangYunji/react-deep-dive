# 11장: Next.js 13과 리액트 18

- Next.js 13 버전의 변화
    - 리액트 18 버전을 채택하였다
    - 레이아웃 지원을 본격적으로 지원한다
    - 웹팩을 대체할 TurboPack을 도입하였다

## 11.1 app 디렉터리의 등장

- Next.js 12 버전까지 모든 페이지는 각각의 물리적으로 구별된 파일로 독립되어 있었다
    - 페이지 공통으로 무언가를 집어 넣을 수 있는 곳은 `_document`와 `_app`이 유일하다
        - `_document`: 페이지에서 쓰이는 `<html>`과 `<body>` 태그를 수정하거나, 서버 사이드 렌더링 시 일부 CSS-in-JS를 지원하기 위한 코드를 삽입한다
        - `_app`: 페이지를 초기화하기 위한 용도로 사용된다
    - 페이지 공통 레이아웃을 유지할 수 있는 방법은 `_app`이 유일하다
    - 각 페이지 별로 서로 다른 레이아웃을 유지하기 어렵다

### 11.1.1 라우팅

- Next.js 13 버전에서는 라우팅과 페이지를 정의하는 방식이 변경되었다
    - 기존에 `/pages`로 정의하던 라우팅 방식이 `/app` 디렉터리로 이동했다
    - 파일명으로 라우팅하는 것이 불가능하다
- 라우팅을 정의하는 방법
    - Next.js의 라우팅은 파일 시스템을 기반으로 하고 있다
    - Next.js 12 버전 이하: 폴더명 + 파일명으로 주소를 변환한다
        - `/pages/a/b.tsx` -> `/a/b`
        - `/pages/a/b/index.tsx` -> `/a/b`
    - Next.js 13 버전: 폴더명까지만 주소로 변환되고 파일명을 무시된다
        - `/app/a/b.tsx` -> `/a`
        - `/app/a/b/index.tsx` -> `/a/b`

#### 폴더에 포함될 수 있는 파일명

- `layout.tsx`: 페이지의 기본적인 레이아웃을 구성하는 요소
    - 해당 폴더에 `layout`이 존재하면 그 하위 폴더 및 주소에 모두 영향을 미친다
    - 루트에는 단 하나의 `layout`만 존재해야 한다
        - 해당 `layout`은 모든 페이지에 영향을 미치는 공통 레이아웃이다
        - 일반적으로 웹페이지를 만드는 데 필요한 공통적인 내용(html, head, body)을 포함한다
    - 페이지 하위에 추가되는 `layout`은 해당 주소 하위에만 적용된다
    - `layout`은 주소별 공통 UI를 포함할 수 있을 뿐만 아니라 `_app`, `_document`를 대신해 웹페이지를 시작하는데 필요한 공통 코드를 삽입할 수 있다
        - 공통 코드는 모든 애플리케이션에 영향을 미치지 않고 오로지 자신과 자식 라우팅에만 미치게 된다
    - `_document.jsx`에서만 처리할 수 있었던 부자연스러움이 사라졌다
        - HTML에서 기본으로 제공하는 `<html/>` 등의 태그를 추가하고 수정할 수 있다
        - 별도로 import하는 번거로움이 사라지고 좀 더 자연스럽게 코드를 작성할 수 있다
    - `layout` 규칙
        - 파일명은 무조건 `layout.{js|jsx|ts|tsx}`여야 한다
        - `layout`은 children을 props로 받아서 렌더링해야 한다
        - `layout` 내부에는 반드시 `export default`로 내보내는 컴포넌트가 있어야 한다
        - `layout` 내부에서도 API 요청과 같은 비동기 작업을 수행할 수 있다
- `page.js`: 페이지를 구성하는 요소
    - `page` 규칙
        - 파일명은 무조건 `page.{js|jsx|ts|tsx}`여야 한다
        - `page` 내부에는 반드시 `export default`로 내보내는 컴포넌트가 있어야 한다
- `error.js`: 해당 라우팅 영역에서 사용되는 공통 에러 컴포넌트
    - 특정 라우팅별로 서로 다른 에러 UI를 렌더링하는 것이 가능하다
    - error 컴포넌트는 클라이언트 컴포넌트여야 한다
    - 같은 수준의 `layout`에서 에러가 발생할 경우 해당 `error` 컴포넌트로 이동하지 않는다
        - 상위 컴포넌트의 error를 사용한다
        - app의 루드 에러 처리를 담당하는 `app/global-error.js` 페이지를 생성한다
- `not-found.js`: 404 에러 페이지를 구성하는 요소
    - 특정 라우팅 하위의 주소를 찾을 수 없는 404 페이지를 렌더링할 때 사용한다
    - 서버 컴포넌트로 구성한다
    - 전체 애플리케이션에서 404를 노출하고 싶다면 `app/not-found.js`를 생성한다
- `loading.js`: 해당 컴포넌트가 불러오는 중임을 나타낼 때 사용한다
- `route.js`: `/app/api`를 기준으로 디렉터리 라우팅을 지원한다
    - 디렉터리가 라우팅 주소를 담당하며 파일명 라우팅이 사라졌다
    - `route.ts`가 존재하는 폴더 내부에는 `page.tsx`가 존재할 수 없다

## 11.2 리액트 서버 컴포넌트

### 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

### 11.2.2 서버 컴포넌트란?

### 11.2.3 서버 사이드 렌더링과 서버 컴포넌트의 차이

### 11.2.4 서버 컴포넌트는 어떻게 작동하는가?

## 11.3 Next.js에서의 리액트 서버 컴포넌트

### 11.3.1 새로운 fetch 도입과 getServerSideProps, getStaticProps, getInitial Props의 삭제

### 11.3.2 정적 렌더링과 동적 렌더링

### 11.3.3 캐시와 mutating, 그리고 revalidating

### 11.3.4 스트리밍을 활용한 점진적인 페이지 불러오기

## 11.4 웹팩의 대항마, 터보팩의 등장(beta)

## 11.5 서버 액션(alpha)

### 11.5.1 form의 action

### 11.5.2 input의 submit과 image의 formAction

### 11.5.3 startTransition과의 연동

### 11.5.4 server mutation이 없는 작업

### 11.5.5 서버 액션 사용 시 주의할 점

## 11.6 그 밖의 변화

## 11.7 Next.js 13 코드 맛보기

### 11.7.1 getServerSideProps와 비슷한 서버 사이드 렌더링 구현해 보기

### 11.7.2 getStaticProps와 비슷한 정적인 페이지 렌더링 구현해 보기

### 11.7.3 로딩, 스트리밍, 서스펜스

## 11.8 정리 및 주의사항
