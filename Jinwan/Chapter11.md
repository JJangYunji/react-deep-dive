## Next.js 13과 리액트 18

### app 디렉터리의 등장

`Next.js` 는 13버전 이전까지 모든 페이지를 각각 물리적으로 구별된 파일로 독립되어 있었음.
페이지 공토으로 무언가를 집어 넣을 수 있는 곳은 `_document`, `_app`이 유일.
그래서 나온 것이 app 레이아웃임

#### 라우팅

기존에는 `/pages`로 정의되던 라우팅 방식이 `/app` 디렉터리로 이동하였고, 파일명으로 라우팅 하는 것이 불가능 해졌다.

- Next.js 12 이하 : /pages/a/b.tsx 또는 /pages/a/b/index.tsx 모두 동일한 주소로 변환

- Next.js 13 : /app/a/b는 /a/b로 변환되며 파일명은 무시

#### layout.js

Next.js 13부터 app 디렉터리 내부의 폴더명이 라우팅 되고, 포함될 수 있는 파일명이 몇가지로 제한. layout은 페이지의 기본적인 레이아웃을 구성하는 요소. **하위 폴더 및 주소**에 모두 영향을 미침.

웹페이지의 공통 코드도 `_app`, `_document`가 아닌 `layout`에서 작성하면 됨.
내부에는 반드시 `export default`로 내보내는 컴포넌트가 있어야 함.

#### page.js

Next.js에서 일반적으로 다뤘던 페이지를 의미.
내부에는 반드시 `export default`로 내보내는 컴포넌트가 있어야 함.

#### error.js

라우팅 영역에서 사용되는 공통 에러 컴포넌트다. 특정 라우팅 별로 서로 다른 에러 UI를 렌더링하는 것이 가능.

#### not-found.js

특정 라우팅 하위의 주소를 찾을 수 없는 404페이지를 렌더링할 때 사용.

#### loading.js

loading은 리액트 Suspense를 기반으로 해당 컴포넌트가 불러오는 중임을 나타낼 때 사용

#### route.js

파일 내부에 REST API의 메소드를 선언해두면 http 요청에 맞게 해당 메소드를 호출

### 리액트 서버 컴포넌트

서버 사이드 렌더링의 모든 문제는 리액트가 클라이언트 중심을 ㅗ돌아가기 때문에 발생.

### 서버 컴포넌트란?

서버 컴포넌트란 하나의 언어, 하나의 프레임워크, 그리고 하나의 api와 개념을 사용하면서 서버와 클라이언트 모두에서 컴포넌트를 렌더링할 수 있는 기법을 의미한다.

- 서버 컴포넌트

  - 요청이 오면 그 순간 서버에서 딱 한 번 실행될 뿐이므로 상태를 가질 수 없다. 즉, 상태 관련 훅을 사용할 수 없다.
  - 렌더링 생명주기도 사용할 수 없다.
  - 앞의 두 가지 제약 사항으로 인해 effect나 state에 의존하는 사용자 정의 훅 또한 사용할 수 없다.
  - 브라우저에서 실행되지 않고 서버에서만 실행되기 때문에 DOM API나 window, document 등을 사용할 수 없다.
  - 데이터베이스, 내부 서비스, 파일 시스템 등 서버에만 있는 데이터를 `async/await`로 접근할 수 있다. 컴포넌트 자체가 async인 것도 가능하다.
  - 다른 서버 컴포넌트를 렌더링하거나 div, span, p 같은 요소를 렌더링하거나, 혹은 클라이언트 컴포넌트를 렌더링할 수 있다.

- 클라이언트 컴포넌트

  - 브라우저 환경에서만 실행되므로 서버 컴포넌트를 불러오거나, 서버 전용 훅이나 유틸리티를 불러올 수 없다.
  - 서버 컴포넌트가 클라이언트 컴포넌트를 렌더링할 때 그 클라이언트 컴포넌트는 서버 컴포넌트를 갖는 구조가 가능하다.

- 공용 컴포넌트
  - 서버와 클라이언트 모두 사용할 수 있다.

### 새로운 fetch 도입

컴포넌트가 비동기적으로 작동하게 되어 서버 컴포넌트는 데이터를 불러오기 전까지 기다렸다가 클라이언트로 전달할 수 있게 되었다.

세부적인 동작 방식은 책을 통해 더 자세하게 확인해보자.
